<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>redisåˆ†å¸ƒå¼é”Redlockçš„å®ç° - è¾£æ¤’ã®é…±</title><meta description="æ™®é€šå®ç° è¯´é“Redisåˆ†å¸ƒå¼é”å¤§éƒ¨åˆ†äººéƒ½ä¼šæƒ³åˆ°ï¼šsetnx+luaï¼Œæˆ–è€…çŸ¥é“set key value px milliseconds nxã€‚åä¸€ç§æ–¹å¼çš„æ ¸å¿ƒå®ç°å‘½ä»¤å¦‚ä¸‹ï¼š"><meta property="og:type" content="blog"><meta property="og:title" content="redisåˆ†å¸ƒå¼é”Redlockçš„å®ç°"><meta property="og:url" content="https://removeif.github.io/"><meta property="og:site_name" content="è¾£æ¤’ã®é…±"><meta property="og:description" content="æ™®é€šå®ç° è¯´é“Redisåˆ†å¸ƒå¼é”å¤§éƒ¨åˆ†äººéƒ½ä¼šæƒ³åˆ°ï¼šsetnx+luaï¼Œæˆ–è€…çŸ¥é“set key value px milliseconds nxã€‚åä¸€ç§æ–¹å¼çš„æ ¸å¿ƒå®ç°å‘½ä»¤å¦‚ä¸‹ï¼š"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190817211453.png"><meta property="article:published_time" content="2019-08-22T10:41:23.000Z"><meta property="article:modified_time" content="2020-01-18T05:58:31.784Z"><meta property="article:author" content="è¾£æ¤’ã®é…±"><meta property="article:tag" content="categories-redis"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190817211453.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://removeif.github.io/database/redis/redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81Redlock%E7%9A%84%E5%AE%9E%E7%8E%B0.html"},"headline":"è¾£æ¤’ã®é…±","image":["https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190817211453.png"],"datePublished":"2019-08-22T10:41:23.000Z","dateModified":"2020-01-18T05:58:31.784Z","author":{"@type":"Person","name":"è¾£æ¤’ã®é…±"},"description":"æ™®é€šå®ç° è¯´é“Redisåˆ†å¸ƒå¼é”å¤§éƒ¨åˆ†äººéƒ½ä¼šæƒ³åˆ°ï¼šsetnx+luaï¼Œæˆ–è€…çŸ¥é“set key value px milliseconds nxã€‚åä¸€ç§æ–¹å¼çš„æ ¸å¿ƒå®ç°å‘½ä»¤å¦‚ä¸‹ï¼š"}</script><link rel="icon" href="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@v2.0.0/images/wico.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@v2.0.0/css/style.css"><script src="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@v2.0.0/js/globalUtils.js"></script><link rel="alternate" href="/atom.xml" title="è¾£æ¤’ã®é…±" type="application/atom+xml">
</head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191121122803.png" alt="è¾£æ¤’ã®é…±" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">é¦–é¡µ</a><a class="navbar-item" href="/archives">å½’æ¡£</a><a class="navbar-item" href="/categories">åˆ†ç±»</a><a class="navbar-item" href="/tags">æ ‡ç­¾</a><a class="navbar-item" href="/tags/%E6%B3%95%E5%BE%8B/">å¾‹æ³•</a><a class="navbar-item" href="/categories/algorithm">ç®—æ³•</a><a class="navbar-item" href="/media">å½±éŸ³</a><a class="navbar-item" href="/album">ç›¸å†Œ</a><a class="navbar-item" href="/friend">å‹é“¾</a><a class="navbar-item" href="/self-talking">ç¢ç¢å¿µ</a><a class="navbar-item" href="/message">ç•™è¨€</a><a class="navbar-item" href="/about">å…³äº</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="ç›®å½•" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@v2.0.0/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="thumbnail" src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20190817211453.png" alt="redisåˆ†å¸ƒå¼é”Redlockçš„å®ç°"></span></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-08-22T10:41:23.000Z">2019-08-22</time><a class="commentCountImg" href="/database/redis/redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81Redlock%E7%9A%84%E5%AE%9E%E7%8E%B0.html#comment-container"><span class="display-none-class">1700fc9043e1d60917136fd68c6fe63e</span><img class="not-gallery-item" src="/img/chat.svg">Â <span class="commentCount" id="1700fc9043e1d60917136fd68c6fe63e">Â 99+</span>Â Â Â Â </a><span class="level-item"><i class="fas fa-folder-open has-text-grey">Â </i><a class="link-muted" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a><span>Â /Â </span><a class="link-muted" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/">redis</a></span><span class="level-item">13 åˆ†é’Ÿ è¯»å®Œ (å¤§çº¦ 1948 ä¸ªå­—)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;&nbsp;<span id="busuanzi_value_page_pv">0</span>æ¬¡è®¿é—®</span></div></div><h1 class="title is-3 is-size-4-mobile">redisåˆ†å¸ƒå¼é”Redlockçš„å®ç°</h1><div class="content"><h2 id="æ™®é€šå®ç°"><a href="#æ™®é€šå®ç°" class="headerlink" title="æ™®é€šå®ç°"></a>æ™®é€šå®ç°</h2><blockquote>
<p>è¯´é“Redisåˆ†å¸ƒå¼é”å¤§éƒ¨åˆ†äººéƒ½ä¼šæƒ³åˆ°ï¼š<code>setnx+lua</code>ï¼Œæˆ–è€…çŸ¥é“<code>set key value px milliseconds nx</code>ã€‚åä¸€ç§æ–¹å¼çš„æ ¸å¿ƒå®ç°å‘½ä»¤å¦‚ä¸‹ï¼š</p>
</blockquote>
<a id="more"></a>

<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- è·å–é”ï¼ˆunique_valueå¯ä»¥æ˜¯UUIDç­‰ï¼‰</span><br><span class="line">SET resource_name unique_value NX PX <span class="number">30000</span></span><br><span class="line"></span><br><span class="line">- é‡Šæ”¾é”ï¼ˆluaè„šæœ¬ä¸­ï¼Œä¸€å®šè¦æ¯”è¾ƒvalueï¼Œé˜²æ­¢è¯¯è§£é”ï¼‰</span><br><span class="line"><span class="keyword">if</span> redis.call(<span class="string">"get"</span>,KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> redis.call(<span class="string">"del"</span>,KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>è¿™ç§å®ç°æ–¹å¼æœ‰3å¤§è¦ç‚¹ï¼ˆä¹Ÿæ˜¯é¢è¯•æ¦‚ç‡éå¸¸é«˜çš„åœ°æ–¹ï¼‰ï¼š</p>
<ol>
<li>setå‘½ä»¤è¦ç”¨<code>set key value px milliseconds nx</code>ï¼›</li>
<li>valueè¦å…·æœ‰å”¯ä¸€æ€§ï¼›</li>
<li>é‡Šæ”¾é”æ—¶è¦éªŒè¯valueå€¼ï¼Œä¸èƒ½è¯¯è§£é”ï¼›</li>
</ol>
<p>äº‹å®ä¸Šè¿™ç±»çæœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯å®ƒåŠ é”æ—¶åªä½œç”¨åœ¨ä¸€ä¸ªRedisèŠ‚ç‚¹ä¸Šï¼Œå³ä½¿Redisé€šè¿‡sentinelä¿è¯é«˜å¯ç”¨ï¼Œå¦‚æœè¿™ä¸ªmasterèŠ‚ç‚¹ç”±äºæŸäº›åŸå› å‘ç”Ÿäº†ä¸»ä»åˆ‡æ¢ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°é”ä¸¢å¤±çš„æƒ…å†µï¼š</p>
<ol>
<li>åœ¨Redisçš„masterèŠ‚ç‚¹ä¸Šæ‹¿åˆ°äº†é”ï¼›</li>
<li>ä½†æ˜¯è¿™ä¸ªåŠ é”çš„keyè¿˜æ²¡æœ‰åŒæ­¥åˆ°slaveèŠ‚ç‚¹ï¼›</li>
<li>masteræ•…éšœï¼Œå‘ç”Ÿæ•…éšœè½¬ç§»ï¼ŒslaveèŠ‚ç‚¹å‡çº§ä¸ºmasterèŠ‚ç‚¹ï¼›</li>
<li>å¯¼è‡´é”ä¸¢å¤±ã€‚</li>
</ol>
<p>æ­£å› ä¸ºå¦‚æ­¤ï¼ŒRedisä½œè€…antirezåŸºäºåˆ†å¸ƒå¼ç¯å¢ƒä¸‹æå‡ºäº†ä¸€ç§æ›´é«˜çº§çš„åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼ï¼š<strong>Redlock</strong>ã€‚ç¬”è€…è®¤ä¸ºï¼ŒRedlockä¹Ÿæ˜¯Redisæ‰€æœ‰åˆ†å¸ƒå¼é”å®ç°æ–¹å¼ä¸­å”¯ä¸€èƒ½è®©é¢è¯•å®˜é«˜æ½®çš„æ–¹å¼ã€‚</p>
<h2 id="Redlockå®ç°"><a href="#Redlockå®ç°" class="headerlink" title="Redlockå®ç°"></a>Redlockå®ç°</h2><p>antirezæå‡ºçš„redlockç®—æ³•å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>
<p>åœ¨Redisçš„åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å‡è®¾æœ‰Nä¸ªRedis masterã€‚è¿™äº›èŠ‚ç‚¹<strong>å®Œå…¨äº’ç›¸ç‹¬ç«‹ï¼Œä¸å­˜åœ¨ä¸»ä»å¤åˆ¶æˆ–è€…å…¶ä»–é›†ç¾¤åè°ƒæœºåˆ¶</strong>ã€‚æˆ‘ä»¬ç¡®ä¿å°†åœ¨Nä¸ªå®ä¾‹ä¸Šä½¿ç”¨ä¸åœ¨Rediså•å®ä¾‹ä¸‹ç›¸åŒæ–¹æ³•è·å–å’Œé‡Šæ”¾é”ã€‚ç°åœ¨æˆ‘ä»¬å‡è®¾æœ‰5ä¸ªRedis masterèŠ‚ç‚¹ï¼ŒåŒæ—¶æˆ‘ä»¬éœ€è¦åœ¨5å°æœåŠ¡å™¨ä¸Šé¢è¿è¡Œè¿™äº›Rediså®ä¾‹ï¼Œè¿™æ ·ä¿è¯ä»–ä»¬ä¸ä¼šåŒæ—¶éƒ½å®•æ‰ã€‚</p>
<p>ä¸ºäº†å–åˆ°é”ï¼Œå®¢æˆ·ç«¯åº”è¯¥æ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p>
<ul>
<li>è·å–å½“å‰Unixæ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</li>
<li>ä¾æ¬¡å°è¯•ä»5ä¸ªå®ä¾‹ï¼Œä½¿ç”¨ç›¸åŒçš„keyå’Œ<strong>å…·æœ‰å”¯ä¸€æ€§çš„value</strong>ï¼ˆä¾‹å¦‚UUIDï¼‰è·å–é”ã€‚å½“å‘Redisè¯·æ±‚è·å–é”æ—¶ï¼Œå®¢æˆ·ç«¯åº”è¯¥è®¾ç½®ä¸€ä¸ªç½‘ç»œè¿æ¥å’Œå“åº”è¶…æ—¶æ—¶é—´ï¼Œè¿™ä¸ªè¶…æ—¶æ—¶é—´åº”è¯¥å°äºé”çš„å¤±æ•ˆæ—¶é—´ã€‚ä¾‹å¦‚ä½ çš„é”è‡ªåŠ¨å¤±æ•ˆæ—¶é—´ä¸º10ç§’ï¼Œåˆ™è¶…æ—¶æ—¶é—´åº”è¯¥åœ¨5-50æ¯«ç§’ä¹‹é—´ã€‚è¿™æ ·å¯ä»¥é¿å…æœåŠ¡å™¨ç«¯Rediså·²ç»æŒ‚æ‰çš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯è¿˜åœ¨æ­»æ­»åœ°ç­‰å¾…å“åº”ç»“æœã€‚å¦‚æœæœåŠ¡å™¨ç«¯æ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…å“åº”ï¼Œå®¢æˆ·ç«¯åº”è¯¥å°½å¿«å°è¯•å»å¦å¤–ä¸€ä¸ªRediså®ä¾‹è¯·æ±‚è·å–é”ã€‚</li>
<li>å®¢æˆ·ç«¯ä½¿ç”¨å½“å‰æ—¶é—´å‡å»å¼€å§‹è·å–é”æ—¶é—´ï¼ˆæ­¥éª¤1è®°å½•çš„æ—¶é—´ï¼‰å°±å¾—åˆ°è·å–é”ä½¿ç”¨çš„æ—¶é—´ã€‚<strong>å½“ä¸”ä»…å½“ä»å¤§å¤šæ•°</strong>ï¼ˆN/2+1ï¼Œè¿™é‡Œæ˜¯3ä¸ªèŠ‚ç‚¹ï¼‰<strong>çš„RedisèŠ‚ç‚¹éƒ½å–åˆ°é”ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ—¶é—´å°äºé”å¤±æ•ˆæ—¶é—´æ—¶ï¼Œé”æ‰ç®—è·å–æˆåŠŸ</strong>ã€‚</li>
<li>å¦‚æœå–åˆ°äº†é”ï¼Œkeyçš„çœŸæ­£æœ‰æ•ˆæ—¶é—´ç­‰äºæœ‰æ•ˆæ—¶é—´å‡å»è·å–é”æ‰€ä½¿ç”¨çš„æ—¶é—´ï¼ˆæ­¥éª¤3è®¡ç®—çš„ç»“æœï¼‰ã€‚</li>
<li>å¦‚æœå› ä¸ºæŸäº›åŸå› ï¼Œè·å–é”å¤±è´¥ï¼ˆæ²¡æœ‰åœ¨è‡³å°‘N/2+1ä¸ªRediså®ä¾‹å–åˆ°é”æˆ–è€…å–é”æ—¶é—´å·²ç»è¶…è¿‡äº†æœ‰æ•ˆæ—¶é—´ï¼‰ï¼Œå®¢æˆ·ç«¯åº”è¯¥åœ¨<strong>æ‰€æœ‰çš„Rediså®ä¾‹ä¸Šè¿›è¡Œè§£é”</strong>ï¼ˆå³ä¾¿æŸäº›Rediså®ä¾‹æ ¹æœ¬å°±æ²¡æœ‰åŠ é”æˆåŠŸï¼Œé˜²æ­¢æŸäº›èŠ‚ç‚¹è·å–åˆ°é”ä½†æ˜¯å®¢æˆ·ç«¯æ²¡æœ‰å¾—åˆ°å“åº”è€Œå¯¼è‡´æ¥ä¸‹æ¥çš„ä¸€æ®µæ—¶é—´ä¸èƒ½è¢«é‡æ–°è·å–é”ï¼‰ã€‚</li>
</ul>
<h2 id="Redlockæºç "><a href="#Redlockæºç " class="headerlink" title="Redlockæºç "></a>Redlockæºç </h2><p>redissonå·²ç»æœ‰å¯¹redlockç®—æ³•å°è£…ï¼Œæ¥ä¸‹æ¥å¯¹å…¶ç”¨æ³•è¿›è¡Œç®€å•ä»‹ç»ï¼Œå¹¶å¯¹æ ¸å¿ƒæºç è¿›è¡Œåˆ†æï¼ˆå‡è®¾5ä¸ªrediså®ä¾‹ï¼‰ã€‚</p>
<ul>
<li>POMä¾èµ–</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.redisson/redisson --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹redissionå°è£…çš„redlockç®—æ³•å®ç°çš„åˆ†å¸ƒå¼é”ç”¨æ³•ï¼Œéå¸¸ç®€å•ï¼Œè·Ÿé‡å…¥é”ï¼ˆReentrantLockï¼‰æœ‰ç‚¹ç±»ä¼¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Config config = <span class="keyword">new</span> Config();</span><br><span class="line">config.useSentinelServers().addSentinelAddress(<span class="string">"127.0.0.1:6369"</span>,<span class="string">"127.0.0.1:6379"</span>, <span class="string">"127.0.0.1:6389"</span>)</span><br><span class="line">        .setMasterName(<span class="string">"masterName"</span>)</span><br><span class="line">        .setPassword(<span class="string">"password"</span>).setDatabase(<span class="number">0</span>);</span><br><span class="line">RedissonClient redissonClient = Redisson.create(config);</span><br><span class="line"><span class="comment">// è¿˜å¯ä»¥getFairLock(), getReadWriteLock()</span></span><br><span class="line">RLock redLock = redissonClient.getLock(<span class="string">"REDLOCK_KEY"</span>);</span><br><span class="line"><span class="keyword">boolean</span> isLock;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    isLock = redLock.tryLock();</span><br><span class="line">    <span class="comment">// 500msæ‹¿ä¸åˆ°é”, å°±è®¤ä¸ºè·å–é”å¤±è´¥ã€‚10000mså³10sæ˜¯é”å¤±æ•ˆæ—¶é—´ã€‚</span></span><br><span class="line">    isLock = redLock.tryLock(<span class="number">500</span>, <span class="number">10000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">    <span class="keyword">if</span> (isLock) &#123;</span><br><span class="line">        <span class="comment">//TODO if get lock success, do something;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// æ— è®ºå¦‚ä½•, æœ€åéƒ½è¦è§£é”</span></span><br><span class="line">    redLock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å”¯ä¸€ID"><a href="#å”¯ä¸€ID" class="headerlink" title="å”¯ä¸€ID"></a>å”¯ä¸€ID</h4><p>å®ç°åˆ†å¸ƒå¼é”çš„ä¸€ä¸ªéå¸¸é‡è¦çš„ç‚¹å°±æ˜¯setçš„valueè¦å…·æœ‰å”¯ä¸€æ€§ï¼Œredissonçš„valueæ˜¯æ€æ ·ä¿è¯valueçš„å”¯ä¸€æ€§å‘¢ï¼Ÿç­”æ¡ˆæ˜¯<strong>UUID+threadId</strong>ã€‚<strong>å…¥å£</strong>åœ¨redissonClient.getLock(â€œREDLOCK_KEYâ€)ï¼Œæºç åœ¨Redisson.javaå’ŒRedissonLock.javaä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> UUID id = UUID.randomUUID();</span><br><span class="line"><span class="function">String <span class="title">getLockName</span><span class="params">(<span class="keyword">long</span> threadId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> id + <span class="string">":"</span> + threadId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è·å–é”"><a href="#è·å–é”" class="headerlink" title="è·å–é”"></a>è·å–é”</h4><p>è·å–é”çš„ä»£ç ä¸ºredLock.tryLock()æˆ–è€…redLock.tryLock(500, 10000, TimeUnit.MILLISECONDS)ï¼Œä¸¤è€…çš„æœ€ç»ˆæ ¸å¿ƒæºç éƒ½æ˜¯ä¸‹é¢è¿™æ®µä»£ç ï¼Œåªä¸è¿‡å‰è€…è·å–é”çš„é»˜è®¤ç§Ÿçº¦æ—¶é—´ï¼ˆleaseTimeï¼‰æ˜¯LOCK_EXPIRATION_INTERVAL_SECONDSï¼Œå³30sï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; <span class="function">RFuture&lt;T&gt; <span class="title">tryLockInnerAsync</span><span class="params">(<span class="keyword">long</span> leaseTime, TimeUnit unit, <span class="keyword">long</span> threadId, RedisStrictCommand&lt;T&gt; command)</span> </span>&#123;</span><br><span class="line">    internalLockLeaseTime = unit.toMillis(leaseTime);</span><br><span class="line">    <span class="comment">// è·å–é”æ—¶å‘5ä¸ªrediså®ä¾‹å‘é€çš„å‘½ä»¤</span></span><br><span class="line">    <span class="keyword">return</span> commandExecutor.evalWriteAsync(getName(), LongCodec.INSTANCE, command,</span><br><span class="line">              <span class="comment">// é¦–å…ˆåˆ†å¸ƒå¼é”çš„KEYä¸èƒ½å­˜åœ¨ï¼Œå¦‚æœç¡®å®ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆæ‰§è¡Œhsetå‘½ä»¤ï¼ˆhset REDLOCK_KEY uuid+threadId 1ï¼‰ï¼Œå¹¶é€šè¿‡pexpireè®¾ç½®å¤±æ•ˆæ—¶é—´ï¼ˆä¹Ÿæ˜¯é”çš„ç§Ÿçº¦æ—¶é—´ï¼‰</span></span><br><span class="line">              <span class="string">"if (redis.call('exists', KEYS[1]) == 0) then "</span> +</span><br><span class="line">                  <span class="string">"redis.call('hset', KEYS[1], ARGV[2], 1); "</span> +</span><br><span class="line">                  <span class="string">"redis.call('pexpire', KEYS[1], ARGV[1]); "</span> +</span><br><span class="line">                  <span class="string">"return nil; "</span> +</span><br><span class="line">              <span class="string">"end; "</span> +</span><br><span class="line">              <span class="comment">// å¦‚æœåˆ†å¸ƒå¼é”çš„KEYå·²ç»å­˜åœ¨ï¼Œå¹¶ä¸”valueä¹ŸåŒ¹é…ï¼Œè¡¨ç¤ºæ˜¯å½“å‰çº¿ç¨‹æŒæœ‰çš„é”ï¼Œé‚£ä¹ˆé‡å…¥æ¬¡æ•°åŠ 1ï¼Œå¹¶ä¸”è®¾ç½®å¤±æ•ˆæ—¶é—´</span></span><br><span class="line">              <span class="string">"if (redis.call('hexists', KEYS[1], ARGV[2]) == 1) then "</span> +</span><br><span class="line">                  <span class="string">"redis.call('hincrby', KEYS[1], ARGV[2], 1); "</span> +</span><br><span class="line">                  <span class="string">"redis.call('pexpire', KEYS[1], ARGV[1]); "</span> +</span><br><span class="line">                  <span class="string">"return nil; "</span> +</span><br><span class="line">              <span class="string">"end; "</span> +</span><br><span class="line">              <span class="comment">// è·å–åˆ†å¸ƒå¼é”çš„KEYçš„å¤±æ•ˆæ—¶é—´æ¯«ç§’æ•°</span></span><br><span class="line">              <span class="string">"return redis.call('pttl', KEYS[1]);"</span>,</span><br><span class="line">              <span class="comment">// è¿™ä¸‰ä¸ªå‚æ•°åˆ†åˆ«å¯¹åº”KEYS[1]ï¼ŒARGV[1]å’ŒARGV[2]</span></span><br><span class="line">                Collections.&lt;Object&gt;singletonList(getName()), internalLockLeaseTime, getLockName(threadId));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è·å–é”çš„å‘½ä»¤ä¸­ï¼Œ</p>
<ul>
<li><strong>KEYS[1]</strong>å°±æ˜¯Collections.singletonList(getName())ï¼Œè¡¨ç¤ºåˆ†å¸ƒå¼é”çš„keyï¼Œå³REDLOCK_KEYï¼›</li>
<li><strong>ARGV[1]</strong>å°±æ˜¯internalLockLeaseTimeï¼Œå³é”çš„ç§Ÿçº¦æ—¶é—´ï¼Œé»˜è®¤30sï¼›</li>
<li><strong>ARGV[2]</strong>å°±æ˜¯getLockName(threadId)ï¼Œæ˜¯è·å–é”æ—¶setçš„å”¯ä¸€å€¼ï¼Œå³UUID+threadIdï¼š</li>
</ul>
<hr>
<h4 id="é‡Šæ”¾é”"><a href="#é‡Šæ”¾é”" class="headerlink" title="é‡Šæ”¾é”"></a>é‡Šæ”¾é”</h4><p>é‡Šæ”¾é”çš„ä»£ç ä¸ºredLock.unlock()ï¼Œæ ¸å¿ƒæºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> RFuture&lt;Boolean&gt; <span class="title">unlockInnerAsync</span><span class="params">(<span class="keyword">long</span> threadId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å‘5ä¸ªrediså®ä¾‹éƒ½æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span></span><br><span class="line">    <span class="keyword">return</span> commandExecutor.evalWriteAsync(getName(), LongCodec.INSTANCE, RedisCommands.EVAL_BOOLEAN,</span><br><span class="line">            <span class="comment">// å¦‚æœåˆ†å¸ƒå¼é”KEYä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå‘channelå‘å¸ƒä¸€æ¡æ¶ˆæ¯</span></span><br><span class="line">            <span class="string">"if (redis.call('exists', KEYS[1]) == 0) then "</span> +</span><br><span class="line">                <span class="string">"redis.call('publish', KEYS[2], ARGV[1]); "</span> +</span><br><span class="line">                <span class="string">"return 1; "</span> +</span><br><span class="line">            <span class="string">"end;"</span> +</span><br><span class="line">            <span class="comment">// å¦‚æœåˆ†å¸ƒå¼é”å­˜åœ¨ï¼Œä½†æ˜¯valueä¸åŒ¹é…ï¼Œè¡¨ç¤ºé”å·²ç»è¢«å ç”¨ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="string">"if (redis.call('hexists', KEYS[1], ARGV[3]) == 0) then "</span> +</span><br><span class="line">                <span class="string">"return nil;"</span> +</span><br><span class="line">            <span class="string">"end; "</span> +</span><br><span class="line">            <span class="comment">// å¦‚æœå°±æ˜¯å½“å‰çº¿ç¨‹å æœ‰åˆ†å¸ƒå¼é”ï¼Œé‚£ä¹ˆå°†é‡å…¥æ¬¡æ•°å‡1</span></span><br><span class="line">            <span class="string">"local counter = redis.call('hincrby', KEYS[1], ARGV[3], -1); "</span> +</span><br><span class="line">            <span class="comment">// é‡å…¥æ¬¡æ•°å‡1åçš„å€¼å¦‚æœå¤§äº0ï¼Œè¡¨ç¤ºåˆ†å¸ƒå¼é”æœ‰é‡å…¥è¿‡ï¼Œé‚£ä¹ˆåªè®¾ç½®å¤±æ•ˆæ—¶é—´ï¼Œè¿˜ä¸èƒ½åˆ é™¤</span></span><br><span class="line">            <span class="string">"if (counter &gt; 0) then "</span> +</span><br><span class="line">                <span class="string">"redis.call('pexpire', KEYS[1], ARGV[2]); "</span> +</span><br><span class="line">                <span class="string">"return 0; "</span> +</span><br><span class="line">            <span class="string">"else "</span> +</span><br><span class="line">                <span class="comment">// é‡å…¥æ¬¡æ•°å‡1åçš„å€¼å¦‚æœä¸º0ï¼Œè¡¨ç¤ºåˆ†å¸ƒå¼é”åªè·å–è¿‡1æ¬¡ï¼Œé‚£ä¹ˆåˆ é™¤è¿™ä¸ªKEYï¼Œå¹¶å‘å¸ƒè§£é”æ¶ˆæ¯</span></span><br><span class="line">                <span class="string">"redis.call('del', KEYS[1]); "</span> +</span><br><span class="line">                <span class="string">"redis.call('publish', KEYS[2], ARGV[1]); "</span> +</span><br><span class="line">                <span class="string">"return 1; "</span>+</span><br><span class="line">            <span class="string">"end; "</span> +</span><br><span class="line">            <span class="string">"return nil;"</span>,</span><br><span class="line">            <span class="comment">// è¿™5ä¸ªå‚æ•°åˆ†åˆ«å¯¹åº”KEYS[1]ï¼ŒKEYS[2]ï¼ŒARGV[1]ï¼ŒARGV[2]å’ŒARGV[3]</span></span><br><span class="line">            Arrays.&lt;Object&gt;asList(getName(), getChannelName()), LockPubSub.unlockMessage, internalLockLeaseTime, getLockName(threadId));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://mp.weixin.qq.com/s?__biz=MzU0MzQ5MDA0Mw==&mid=2247485917&idx=1&sn=289fd9fcd1c8141111b8bc337e8c5353&chksm=fb0be349cc7c6a5f1c525c97f2d8a90d712475e58bcf79b3b1f8d83f4cd8a0fa617acf1de955&token=1885824046&lang=zh_CN&scene=21#wechat_redirect">æ–‡ç« æ¥æº</a></p>
<p>.</p>
</div><div class="article-tags size-small is-uppercase mb-4"><i class="fas fa-tags has-text-grey"></i>Â <a class="link-muted mr-2" rel="tag" href="/tags/redis/">redis</a></div><ul class="post-copyright"><li><strong>æœ¬æ–‡æ ‡é¢˜ï¼š</strong><a href="https://removeif.github.io/database/redis/redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81Redlock%E7%9A%84%E5%AE%9E%E7%8E%B0.html">redisåˆ†å¸ƒå¼é”Redlockçš„å®ç°</a></li><li><strong>æœ¬æ–‡ä½œè€…ï¼š</strong><a href="https://removeif.github.io">è¾£æ¤’ã®é…±</a></li><li><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="https://removeif.github.io/database/redis/redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81Redlock%E7%9A%84%E5%AE%9E%E7%8E%B0.html">https://removeif.github.io/database/redis/redisåˆ†å¸ƒå¼é”Redlockçš„å®ç°.html</a></li><li><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li></ul><div class="recommend-post"><span class="is-size-6 has-text-grey has-mr-7">#Â æ¨èæ–‡ç« </span><br><span>Â Â 1.<a class="is-size-6" href="/theme/%E5%8D%9A%E5%AE%A2%E6%BA%90%E7%A0%81%E5%88%86%E4%BA%AB.html" target="_blank">åšå®¢æºç åˆ†äº«</a><br></span><span>Â Â 2.<a class="is-size-6" href="/breaking-news/2019%E5%B9%B4%E5%9B%BD%E5%BA%8670%E5%91%A8%E5%B9%B4%E9%98%85%E5%85%B5%E5%AE%8C%E6%95%B4%E5%9B%BE%E6%96%87%E8%A7%A3%E8%AF%B4.html" target="_blank">2019å¹´å›½åº†70å‘¨å¹´é˜…å…µå®Œæ•´å›¾æ–‡è§£è¯´(æ”¶è—!)</a><br></span><span>Â Â 3.<a class="is-size-6" href="/theme/%E5%8D%9A%E5%AE%A2%E4%B8%ADgitalk%E6%9C%80%E6%96%B0%E8%AF%84%E8%AE%BA%E7%9A%84%E8%8E%B7%E5%8F%96.html" target="_blank">åšå®¢ä¸­gitalkæœ€æ–°è¯„è®ºçš„è·å–</a><br></span><span>Â Â 4.<a class="is-size-6" href="/law/%E4%B8%AD%E5%8D%8E%E4%BA%BA%E6%B0%91%E5%85%B1%E5%92%8C%E5%9B%BD%E5%88%91%E4%BA%8B%E8%AF%89%E8%AE%BC%E6%B3%95.html" target="_blank">ä¸­åäººæ°‘å…±å’Œå›½åˆ‘äº‹è¯‰è®¼æ³•</a><br></span><span>Â Â 5.<a class="is-size-6" href="/java/frame/springboot%E4%BC%98%E9%9B%85%E7%9A%84%E5%81%9C%E6%AD%A2%E6%9C%8D%E5%8A%A1.html" target="_blank">springbootä¼˜é›…çš„åœæ­¢æœåŠ¡</a><br></span></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><div class="social-share"></div><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Ÿæ‰“èµä¸€ä¸‹ä½œè€…å§</h3><div class="buttons is-centered"><a class="button is-info donate"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>æ”¯ä»˜å®</span><span class="qrcode"><img src="https://raw.githubusercontent.com/removeif/blog_image/master/img/2019/20190802135456.png" alt="æ”¯ä»˜å®"></span></a><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>å¾®ä¿¡</span><span class="qrcode"><img src="https://raw.githubusercontent.com/removeif/blog_image/master/img/2019/20190802135550.png" alt="å¾®ä¿¡"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/develop/Vim%E5%9F%BA%E6%9C%AC%E5%85%A5%E9%97%A8%E6%93%8D%E4%BD%9C.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">VimåŸºæœ¬å…¥é—¨æ“ä½œ</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/law/%E4%B8%AD%E5%8D%8E%E4%BA%BA%E6%B0%91%E5%85%B1%E5%92%8C%E5%9B%BD%E6%B6%88%E8%B4%B9%E8%80%85%E6%9D%83%E7%9B%8A%E4%BF%9D%E6%8A%A4%E6%B3%95.html"><span class="level-item">ä¸­åäººæ°‘å…±å’Œå›½æ¶ˆè´¹è€…æƒç›Šä¿æŠ¤æ³•</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">è¯„è®º</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@v2.0.0/js/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: '1700fc9043e1d60917136fd68c6fe63e',
            repo: 'blog_comment',
            owner: 'removeif',
            clientID: '46a9f3481b46ea0129d8',
            clientSecret: '79c7c9cb847e141757d7864453bcbf89f0655b24',
            admin: ["removeif"],
            createIssueManually: true,
            distractionFreeMode: false,
            perPage: 10,
            pagerDirection: 'last',
            
            
            enableHotKey: true,
            isLocked: false
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@v2.0.0/images/tuzi.jpg" alt="è¾£æ¤’ã®é…±"></figure><p class="title is-size-4 is-block line-height-inherit">è¾£æ¤’ã®é…±</p><p class="is-size-6 is-block">å°šæœªæ‰§ä½©å‰‘ï¼Œè½¬çœ¼å³æ±Ÿæ¹–</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>é˜¿å°”åŠåˆ©äºš</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">85</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories"><p class="title">36</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags"><p class="title">67</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://weibo.com/u/3050419984" target="_blank" rel="noopener">å…³æ³¨æˆ‘</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/removeif"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://weibo.com/u/3050419984"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:removeif@163.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="Next" href="https://removeif.github.io/remove.io"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-white is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><hr><p id="hitokoto">:D ä¸€è¨€å¥å­è·å–ä¸­...</p><script src="https://v1.hitokoto.cn/?encode=js&amp;select=%23hitokoto" defer></script></div></div><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">ç›®å½•</h3><ul class="menu-list"><li><a class="is-flex" href="#æ™®é€šå®ç°"><span class="mr-2">1</span><span>æ™®é€šå®ç°</span></a></li><li><a class="is-flex" href="#Redlockå®ç°"><span class="mr-2">2</span><span>Redlockå®ç°</span></a></li><li><a class="is-flex" href="#Redlockæºç "><span class="mr-2">3</span><span>Redlockæºç </span></a><ul class="menu-list"><ul class="menu-list"><li><a class="is-flex" href="#ç”¨æ³•"><span class="mr-2">3.1.1</span><span>ç”¨æ³•</span></a></li><li><a class="is-flex" href="#å”¯ä¸€ID"><span class="mr-2">3.1.2</span><span>å”¯ä¸€ID</span></a></li><li><a class="is-flex" href="#è·å–é”"><span class="mr-2">3.1.3</span><span>è·å–é”</span></a></li><li><a class="is-flex" href="#é‡Šæ”¾é”"><span class="mr-2">3.1.4</span><span>é‡Šæ”¾é”</span></a></li></ul></ul></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">æœ€æ–°è¯„è®º</h3><span class="body_hot_comment">åŠ è½½ä¸­ï¼Œæœ€æ–°è¯„è®ºæœ‰10åˆ†é’Ÿå»¶è¿Ÿ...</span></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><a class="media-left" href="/java/frame/springboot%E4%BC%98%E9%9B%85%E7%9A%84%E5%81%9C%E6%AD%A2%E6%9C%8D%E5%8A%A1.html"><p class="image is-64x64"><img class="thumbnail" src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2020/20200112211023.png" alt="springbootä¼˜é›…çš„åœæ­¢æœåŠ¡"></p></a><div class="media-content size-small"><p><time dateTime="2020-01-12T13:08:28.000Z">2020-01-12</time></p><p class="title is-6"><a class="link-muted" href="/java/frame/springboot%E4%BC%98%E9%9B%85%E7%9A%84%E5%81%9C%E6%AD%A2%E6%9C%8D%E5%8A%A1.html">springbootä¼˜é›…çš„åœæ­¢æœåŠ¡</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey">Â </i><a class="link-muted" href="/categories/java/">java</a> / <a class="link-muted" href="/categories/java/springboot/">springboot</a></p></div></article><article class="media"><a class="media-left" href="/algorithm/%E7%AE%97%E6%B3%95%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AFleetcode17-18.html"><p class="image is-64x64"><img class="thumbnail" src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2020/20200108220236.png" alt="ç®—æ³•æˆé•¿ä¹‹è·¯leetcode17-18"></p></a><div class="media-content size-small"><p><time dateTime="2020-01-08T13:55:24.000Z">2020-01-08</time></p><p class="title is-6"><a class="link-muted" href="/algorithm/%E7%AE%97%E6%B3%95%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AFleetcode17-18.html">ç®—æ³•æˆé•¿ä¹‹è·¯leetcode17-18</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey">Â </i><a class="link-muted" href="/categories/algorithm/">algorithm</a></p></div></article><article class="media"><a class="media-left" href="/java/frame/springboot-restful-swagger%E5%AE%9E%E6%88%98.html"><p class="image is-64x64"><img class="thumbnail" src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2020/20200104181336.png" alt="springboot-restful-swaggerå®æˆ˜"></p></a><div class="media-content size-small"><p><time dateTime="2020-01-04T10:11:19.000Z">2020-01-04</time></p><p class="title is-6"><a class="link-muted" href="/java/frame/springboot-restful-swagger%E5%AE%9E%E6%88%98.html">springboot-restful-swaggerå®æˆ˜</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey">Â </i><a class="link-muted" href="/categories/java/">java</a> / <a class="link-muted" href="/categories/java/springboot/">springboot</a></p></div></article><article class="media"><a class="media-left" href="/algorithm/%E7%AE%97%E6%B3%95%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AFleetcode15-16.html"><p class="image is-64x64"><img class="thumbnail" src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2020/20200101211709.png" alt="ç®—æ³•æˆé•¿ä¹‹è·¯leetcode15-16"></p></a><div class="media-content size-small"><p><time dateTime="2020-01-01T13:14:27.000Z">2020-01-01</time></p><p class="title is-6"><a class="link-muted" href="/algorithm/%E7%AE%97%E6%B3%95%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AFleetcode15-16.html">ç®—æ³•æˆé•¿ä¹‹è·¯leetcode15-16</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey">Â </i><a class="link-muted" href="/categories/algorithm/">algorithm</a></p></div></article><article class="media"><a class="media-left" href="/think/2019%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93.html"><p class="image is-64x64"><img class="thumbnail" src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191231210830.png" alt="2019å¹´ç»ˆæ€»ç»“"></p></a><div class="media-content size-small"><p><time dateTime="2019-12-31T13:05:49.000Z">2019-12-31</time></p><p class="title is-6"><a class="link-muted" href="/think/2019%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93.html">2019å¹´ç»ˆæ€»ç»“</a></p><p class="is-uppercase"><i class="fas fa-folder-open has-text-grey">Â </i><a class="link-muted" href="/categories/think/">think</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">å½’æ¡£</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">ä¸€æœˆ 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">åäºŒæœˆ 2019</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">åæœˆ 2019</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">ä¹æœˆ 2019</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2019</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">æ ‡ç­¾</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">java</span><span class="tag is-grey-lightest">18</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B3%95%E5%BE%8B/"><span class="tag">æ³•å¾‹</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span class="tag">è®¾è®¡æ¨¡å¼</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql/"><span class="tag">mysql</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/"><span class="tag">å·¥å…·æ•™ç¨‹</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/think/"><span class="tag">think</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/"><span class="tag">äºŒåˆ†æŸ¥æ‰¾</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dp/"><span class="tag">dp</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/elasticsearch6/"><span class="tag">elasticsearch6</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo%E4%B8%BB%E9%A2%98/"><span class="tag">hexoä¸»é¢˜</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/icarus%E4%B8%BB%E9%A2%98%E9%85%8D%E7%BD%AE/"><span class="tag">icarusä¸»é¢˜é…ç½®</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/redis/"><span class="tag">redis</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/springboot/"><span class="tag">springboot</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"><span class="tag">åŠ¨æ€è§„åˆ’</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%8C%E6%8C%87%E9%92%88/"><span class="tag">åŒæŒ‡é’ˆ</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%94%AF%E4%BB%98%E6%9E%B6%E6%9E%84/"><span class="tag">æ”¯ä»˜æ¶æ„</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F/"><span class="tag">æ”¯ä»˜ç³»ç»Ÿ</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A7%91%E6%99%AE/"><span class="tag">ç§‘æ™®</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95/"><span class="tag">è´ªå¿ƒç®—æ³•</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Effective-Java/"><span class="tag">Effective-Java</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Z%E5%AD%97%E5%8F%98%E6%8D%A2/"><span class="tag">Zå­—å˜æ¢</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">è®¢é˜…æ›´æ–°</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=removeifFeedsId&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="removeifFeedsId" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="è®¢é˜…"></div></div><p class="help">è¾“å…¥é‚®ç®±å¼€å§‹è®¢é˜…ï¼Œæ›´åšåé‚®ä»¶é€šçŸ¥ï¼</p></form></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/img/2019/20191121122803.png" alt="è¾£æ¤’ã®é…±" height="28"></a><p class="size-small"><span>&copy; 2020 è¾£æ¤’ã®é…±</span>Â Â Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>,Modify by <a href="https://github.com/removeif">removeif</a>Â <br>Â© ç‰ˆæƒè¯´æ˜ï¼š[æœ¬ç½‘ç«™æ‰€æœ‰å†…å®¹å‡æ”¶é›†äºäº’è”ç½‘æˆ–è‡ªå·±åˆ›ä½œ,<br>Â Â Â Â æ–¹ä¾¿äºç½‘å‹ä¸è‡ªå·±å­¦ä¹ äº¤æµï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·<a href="https://removeif.github.io/message/" target="_blank">ç•™è¨€</a>ï¼Œç«‹å³å¤„ç†]<br><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@v2.0.0/js/statistics.js"></script><span id="statistic-times"></span><br><div class="size-small"><span id="busuanzi_container_site_uv">â¤ï¸æ„Ÿè°¢<strong>Â <span id="busuanzi_value_site_uv">99+</span>Â </strong></span>å°ä¼™ä¼´çš„<strong>Â <span id="busuanzi_value_site_pv">99+</span>Â </strong>æ¬¡å…‰ä¸´ï¼Œè´¡çŒ®ğŸ’<a href="https://github.com/removeif/hexo-theme-icarus-removeif" target="_blank">æœ¬ç«™æºç </a>ï¼â¤ï¸</div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://removeif.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@v2.0.0/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@v2.0.0/js/back-to-top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@v2.0.0/js/gallery.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@v2.0.0/js/main.js" defer></script><script src="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@v2.0.0/js/comment-issue-data.js" defer></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@v2.0.0/css/insight.css"><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."><span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>(function (window) {
            var INSIGHT_CONFIG = {
                TRANSLATION: {
                    POSTS: 'æ–‡ç« ',
                    PAGES: 'é¡µé¢',
                    CATEGORIES: 'åˆ†ç±»',
                    TAGS: 'æ ‡ç­¾',
                    UNTITLED: '(æ— æ ‡é¢˜)',
                },
                CONTENT_URL: 'https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@v2.0.0/content.json',
            };
            window.INSIGHT_CONFIG = INSIGHT_CONFIG;
        })(window);</script><script src="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@v2.0.0/js/insight.js" defer></script></body></html>