<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/remove.io/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/remove.io/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/remove.io/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@master/images/wico.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@master/images/wico.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@master/images/wico.png?v=5.1.4">


  <link rel="mask-icon" href="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@master/images/wico.png?v=5.1.4" color="#222">





  <meta name="keywords" content="java">





  <link rel="alternate" href="/remove.io/atom.xml" title="辣椒の酱" type="application/atom+xml">






<meta name="description" content="摘要针对项目中部分使用restful-api接口，总结文档如下，没有规矩不成方圆。写代码亦是，设计restful-api接口亦是。">
<meta name="keywords" content="java">
<meta property="og:type" content="article">
<meta property="og:title" content="restful api 设计以及幂等性相关设计">
<meta property="og:url" content="https://removeif.github.io/design-architecture/restful-api-设计以及幂等性相关设计.html">
<meta property="og:site_name" content="辣椒の酱">
<meta property="og:description" content="摘要针对项目中部分使用restful-api接口，总结文档如下，没有规矩不成方圆。写代码亦是，设计restful-api接口亦是。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620160456.png">
<meta property="og:updated_time" content="2019-09-25T08:32:55.446Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="restful api 设计以及幂等性相关设计">
<meta name="twitter:description" content="摘要针对项目中部分使用restful-api接口，总结文档如下，没有规矩不成方圆。写代码亦是，设计restful-api接口亦是。">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620160456.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/remove.io/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://removeif.github.io/design-architecture/restful-api-设计以及幂等性相关设计.html">





  <title>restful api 设计以及幂等性相关设计 | 辣椒の酱</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/remove.io/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">辣椒の酱</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">尚未执佩剑，转眼即江湖</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/remove.io/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/remove.io/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/remove.io/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/remove.io/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-留言">
          <a href="https://removeif.github.io/message/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            留言
          </a>
        </li>
      
        
        <li class="menu-item menu-item-主站">
          <a href="https://removeif.github.io/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            主站
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://removeif.github.io/remove.io/design-architecture/restful-api-设计以及幂等性相关设计.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="辣椒の酱">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@master/images/tuzi.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="辣椒の酱">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">restful api 设计以及幂等性相关设计</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-18T17:26:33+08:00">
                2019-04-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/remove.io/categories/架构/" itemprop="url" rel="index">
                    <span itemprop="name">架构</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/remove.io/categories/架构/设计/" itemprop="url" rel="index">
                    <span itemprop="name">设计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>摘要<br>针对项目中部分使用restful-api接口，总结文档如下，没有规矩不成方圆。写代码亦是，设计restful-api接口亦是。<br><a id="more"></a></p>
</blockquote>
<blockquote>
<p>RESTful 的核心思想就是，客户端发出的数据操作指令都是”动词 + 宾语”的结构。比如，<code>GET /articles</code>这个命令，<code>GET</code>是动词，<code>/articles</code>是宾语。</p>
<p>动词通常就是五种 HTTP 方法，对应 CRUD 操作。</p>
<blockquote>
<ul>
<li>GET：读取（Read）</li>
<li>POST：新建（Create）</li>
<li>PUT：更新（Update）</li>
<li>PATCH：更新（Update），通常是部分更新</li>
<li>DELETE：删除（Delete）</li>
</ul>
</blockquote>
<p>根据 HTTP 规范，动词一律大写</p>
</blockquote>
<p>话不多说，先上代码，一份完整的restful-api示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"admin/biz-name/v1/user"</span>) <span class="comment">//@RequestMapping("api/biz-name/v1/city")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminUserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService service;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"&#123;id&#125;/county/list"</span>) </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;UserView&gt; <span class="title">getUsersByCategoryId</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getUsersByCategoryId(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserView <span class="title">userInfoById</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getUserInfoById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">create</span><span class="params">(@RequestBody UserEntityForm form)</span> </span>&#123;</span><br><span class="line">      	<span class="comment">// 相关验证valid  设置默认值</span></span><br><span class="line">      	service.valid(form);</span><br><span class="line">        <span class="keyword">if</span> (StringUtil.isEmpty(form.getCsEmail())) &#123;</span><br><span class="line">            form.setCsEmail(<span class="string">"980099577@qq.com"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Integer id = service.ceate(form);</span><br><span class="line">        <span class="keyword">return</span> Collections.singletonMap(<span class="string">"id"</span>, id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">update</span><span class="params">(@RequestBody UserEntityForm form)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 相关验证 valid</span></span><br><span class="line">        service.valid(form);</span><br><span class="line">        service.update(form);</span><br><span class="line">        <span class="keyword">return</span> Result.SUCCEED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping</span>(<span class="string">"&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">delete</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">				<span class="comment">// 相关验证 valid</span></span><br><span class="line">        service.valid(form);</span><br><span class="line">        service.delete(id);</span><br><span class="line">        <span class="keyword">return</span> Result.SUCCEED;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="针对以上restful-api-代码需要注意一下几点："><a href="#针对以上restful-api-代码需要注意一下几点：" class="headerlink" title="针对以上restful-api 代码需要注意一下几点："></a>针对以上restful-api 代码需要注意一下几点：</h2><h3 id="RestController-注解"><a href="#RestController-注解" class="headerlink" title="@RestController 注解"></a>@RestController 注解</h3><p>此注解加在类的上面，返回的结果以json格式，标注此为RestController。不同于Controller注解。Controller非json格式返回。</p>
<h3 id="RequestMapping"><a href="#RequestMapping" class="headerlink" title="@RequestMapping"></a>@RequestMapping</h3><p>此注解标识api请求的路劲，可指定相应的请求方法，例如@RequestMapping(“admin/biz-name/v1/user”)：<a href="http://localhost:8080/admin/biz-name/v1/user" target="_blank" rel="noopener">http://localhost:8080/admin/biz-name/v1/user</a></p>
<p>有如下定义参数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Mapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RequestMapping &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Assign a name to this mapping.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;&lt;b&gt;Supported at the type level as well as at the method level!&lt;/b&gt;</span></span><br><span class="line"><span class="comment">	 * When used on both levels, a combined name is derived by concatenation</span></span><br><span class="line"><span class="comment">	 * with "#" as separator.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> org.springframework.web.servlet.mvc.method.annotation.MvcUriComponentsBuilder</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> org.springframework.web.servlet.handler.HandlerMethodMappingNamingStrategy</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The primary mapping expressed by this annotation.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;In a Servlet environment this is an alias for &#123;<span class="doctag">@link</span> #path&#125;.</span></span><br><span class="line"><span class="comment">	 * For example &#123;<span class="doctag">@code</span> <span class="doctag">@RequestMapping</span>("/foo")&#125; is equivalent to</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@code</span> <span class="doctag">@RequestMapping</span>(path="/foo")&#125;.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;In a Portlet environment this is the mapped portlet modes</span></span><br><span class="line"><span class="comment">	 * (i.e. "EDIT", "VIEW", "HELP" or any custom modes).</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;&lt;b&gt;Supported at the type level as well as at the method level!&lt;/b&gt;</span></span><br><span class="line"><span class="comment">	 * When used at the type level, all method-level mappings inherit</span></span><br><span class="line"><span class="comment">	 * this primary mapping, narrowing it for a specific handler method.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@AliasFor</span>(<span class="string">"path"</span>)</span><br><span class="line">	String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * In a Servlet environment only: the path mapping URIs (e.g. "/myPath.do").</span></span><br><span class="line"><span class="comment">	 * Ant-style path patterns are also supported (e.g. "/myPath/*.do").</span></span><br><span class="line"><span class="comment">	 * At the method level, relative paths (e.g. "edit.do") are supported within</span></span><br><span class="line"><span class="comment">	 * the primary mapping expressed at the type level. Path mapping URIs may</span></span><br><span class="line"><span class="comment">	 * contain placeholders (e.g. "/$&#123;connect&#125;")</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;&lt;b&gt;Supported at the type level as well as at the method level!&lt;/b&gt;</span></span><br><span class="line"><span class="comment">	 * When used at the type level, all method-level mappings inherit</span></span><br><span class="line"><span class="comment">	 * this primary mapping, narrowing it for a specific handler method.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> org.springframework.web.bind.annotation.ValueConstants#DEFAULT_NONE</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@since</span> 4.2</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@AliasFor</span>(<span class="string">"value"</span>)</span><br><span class="line">	String[] path() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The HTTP request methods to map to, narrowing the primary mapping:</span></span><br><span class="line"><span class="comment">	 * GET, POST, HEAD, OPTIONS, PUT, PATCH, DELETE, TRACE.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;&lt;b&gt;Supported at the type level as well as at the method level!&lt;/b&gt;</span></span><br><span class="line"><span class="comment">	 * When used at the type level, all method-level mappings inherit</span></span><br><span class="line"><span class="comment">	 * this HTTP method restriction (i.e. the type-level restriction</span></span><br><span class="line"><span class="comment">	 * gets checked before the handler method is even resolved).</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Supported for Servlet environments as well as Portlet 2.0 environments.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	RequestMethod[] method() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The parameters of the mapped request, narrowing the primary mapping.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Same format for any environment: a sequence of "myParam=myValue" style</span></span><br><span class="line"><span class="comment">	 * expressions, with a request only mapped if each such parameter is found</span></span><br><span class="line"><span class="comment">	 * to have the given value. Expressions can be negated by using the "!=" operator,</span></span><br><span class="line"><span class="comment">	 * as in "myParam!=myValue". "myParam" style expressions are also supported,</span></span><br><span class="line"><span class="comment">	 * with such parameters having to be present in the request (allowed to have</span></span><br><span class="line"><span class="comment">	 * any value). Finally, "!myParam" style expressions indicate that the</span></span><br><span class="line"><span class="comment">	 * specified parameter is &lt;i&gt;not&lt;/i&gt; supposed to be present in the request.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;&lt;b&gt;Supported at the type level as well as at the method level!&lt;/b&gt;</span></span><br><span class="line"><span class="comment">	 * When used at the type level, all method-level mappings inherit</span></span><br><span class="line"><span class="comment">	 * this parameter restriction (i.e. the type-level restriction</span></span><br><span class="line"><span class="comment">	 * gets checked before the handler method is even resolved).</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;In a Servlet environment, parameter mappings are considered as restrictions</span></span><br><span class="line"><span class="comment">	 * that are enforced at the type level. The primary path mapping (i.e. the</span></span><br><span class="line"><span class="comment">	 * specified URI value) still has to uniquely identify the target handler, with</span></span><br><span class="line"><span class="comment">	 * parameter mappings simply expressing preconditions for invoking the handler.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;In a Portlet environment, parameters are taken into account as mapping</span></span><br><span class="line"><span class="comment">	 * differentiators, i.e. the primary portlet mode mapping plus the parameter</span></span><br><span class="line"><span class="comment">	 * conditions uniquely identify the target handler. Different handlers may be</span></span><br><span class="line"><span class="comment">	 * mapped onto the same portlet mode, as long as their parameter mappings differ.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	String[] params() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The headers of the mapped request, narrowing the primary mapping.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Same format for any environment: a sequence of "My-Header=myValue" style</span></span><br><span class="line"><span class="comment">	 * expressions, with a request only mapped if each such header is found</span></span><br><span class="line"><span class="comment">	 * to have the given value. Expressions can be negated by using the "!=" operator,</span></span><br><span class="line"><span class="comment">	 * as in "My-Header!=myValue". "My-Header" style expressions are also supported,</span></span><br><span class="line"><span class="comment">	 * with such headers having to be present in the request (allowed to have</span></span><br><span class="line"><span class="comment">	 * any value). Finally, "!My-Header" style expressions indicate that the</span></span><br><span class="line"><span class="comment">	 * specified header is &lt;i&gt;not&lt;/i&gt; supposed to be present in the request.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Also supports media type wildcards (*), for headers such as Accept</span></span><br><span class="line"><span class="comment">	 * and Content-Type. For instance,</span></span><br><span class="line"><span class="comment">	 * &lt;pre class="code"&gt;</span></span><br><span class="line"><span class="comment">	 * &amp;#064;RequestMapping(value = "/something", headers = "content-type=text/*")</span></span><br><span class="line"><span class="comment">	 * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment">	 * will match requests with a Content-Type of "text/html", "text/plain", etc.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;&lt;b&gt;Supported at the type level as well as at the method level!&lt;/b&gt;</span></span><br><span class="line"><span class="comment">	 * When used at the type level, all method-level mappings inherit</span></span><br><span class="line"><span class="comment">	 * this header restriction (i.e. the type-level restriction</span></span><br><span class="line"><span class="comment">	 * gets checked before the handler method is even resolved).</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Maps against HttpServletRequest headers in a Servlet environment,</span></span><br><span class="line"><span class="comment">	 * and against PortletRequest properties in a Portlet 2.0 environment.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> org.springframework.http.MediaType</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	String[] headers() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The consumable media types of the mapped request, narrowing the primary mapping.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;The format is a single media type or a sequence of media types,</span></span><br><span class="line"><span class="comment">	 * with a request only mapped if the &#123;<span class="doctag">@code</span> Content-Type&#125; matches one of these media types.</span></span><br><span class="line"><span class="comment">	 * Examples:</span></span><br><span class="line"><span class="comment">	 * &lt;pre class="code"&gt;</span></span><br><span class="line"><span class="comment">	 * consumes = "text/plain"</span></span><br><span class="line"><span class="comment">	 * consumes = &#123;"text/plain", "application/*"&#125;</span></span><br><span class="line"><span class="comment">	 * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment">	 * Expressions can be negated by using the "!" operator, as in "!text/plain", which matches</span></span><br><span class="line"><span class="comment">	 * all requests with a &#123;<span class="doctag">@code</span> Content-Type&#125; other than "text/plain".</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;&lt;b&gt;Supported at the type level as well as at the method level!&lt;/b&gt;</span></span><br><span class="line"><span class="comment">	 * When used at the type level, all method-level mappings override</span></span><br><span class="line"><span class="comment">	 * this consumes restriction.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> org.springframework.http.MediaType</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> javax.servlet.http.HttpServletRequest#getContentType()</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	String[] consumes() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The producible media types of the mapped request, narrowing the primary mapping.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;The format is a single media type or a sequence of media types,</span></span><br><span class="line"><span class="comment">	 * with a request only mapped if the &#123;<span class="doctag">@code</span> Accept&#125; matches one of these media types.</span></span><br><span class="line"><span class="comment">	 * Examples:</span></span><br><span class="line"><span class="comment">	 * &lt;pre class="code"&gt;</span></span><br><span class="line"><span class="comment">	 * produces = "text/plain"</span></span><br><span class="line"><span class="comment">	 * produces = &#123;"text/plain", "application/*"&#125;</span></span><br><span class="line"><span class="comment">	 * produces = "application/json; charset=UTF-8"</span></span><br><span class="line"><span class="comment">	 * &lt;/pre&gt;</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;It affects the actual content type written, for example to produce a JSON response</span></span><br><span class="line"><span class="comment">	 * with UTF-8 encoding, &#123;<span class="doctag">@code</span> "application/json; charset=UTF-8"&#125; should be used.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Expressions can be negated by using the "!" operator, as in "!text/plain", which matches</span></span><br><span class="line"><span class="comment">	 * all requests with a &#123;<span class="doctag">@code</span> Accept&#125; other than "text/plain".</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;&lt;b&gt;Supported at the type level as well as at the method level!&lt;/b&gt;</span></span><br><span class="line"><span class="comment">	 * When used at the type level, all method-level mappings override</span></span><br><span class="line"><span class="comment">	 * this produces restriction.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@see</span> org.springframework.http.MediaType</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	String[] produces() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="GetMapping"><a href="#GetMapping" class="headerlink" title="@GetMapping"></a>@GetMapping</h3><p>此注解，接收前端为get请求的相关方法,接口返回天生具有<strong>幂等性</strong>，每次请求参数一致返回的结果也一致</p>
<p>此注解请求一般为获取相关信息的方法</p>
<p>有如下参数，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(method = RequestMethod.GET)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> GetMapping &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Alias for &#123;<span class="doctag">@link</span> RequestMapping#name&#125;.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@AliasFor</span>(annotation = RequestMapping.class)</span><br><span class="line">	<span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Alias for &#123;<span class="doctag">@link</span> RequestMapping#value&#125;.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@AliasFor</span>(annotation = RequestMapping.class)</span><br><span class="line">	String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Alias for &#123;<span class="doctag">@link</span> RequestMapping#path&#125;.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@AliasFor</span>(annotation = RequestMapping.class)</span><br><span class="line">	String[] path() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Alias for &#123;<span class="doctag">@link</span> RequestMapping#params&#125;.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@AliasFor</span>(annotation = RequestMapping.class)</span><br><span class="line">	String[] params() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Alias for &#123;<span class="doctag">@link</span> RequestMapping#headers&#125;.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@AliasFor</span>(annotation = RequestMapping.class)</span><br><span class="line">	String[] headers() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Alias for &#123;<span class="doctag">@link</span> RequestMapping#produces&#125;.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@AliasFor</span>(annotation = RequestMapping.class)</span><br><span class="line">	String[] produces() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="PostMapping"><a href="#PostMapping" class="headerlink" title="@PostMapping"></a>@PostMapping</h3><p>此注解，接收前端为post请求的相关方法</p>
<p>一般为保存，创建信息的方法，save…,create…</p>
<h3 id="putMapping"><a href="#putMapping" class="headerlink" title="@putMapping"></a>@putMapping</h3><p>此注解，接收前端为put请求的相关方法</p>
<p>一般为更新数据的接口方法，update…</p>
<h3 id="deleteMapping"><a href="#deleteMapping" class="headerlink" title="@deleteMapping"></a>@deleteMapping</h3><p>此注解，接收前端为delete请求的相关方法</p>
<p>一般为删除数据的方法</p>
<h3 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a>@RequestBody</h3><p>此注解放入接口方法的参数前面，对应请求中的body里的内容，要求body内容为json格式</p>
<p>例如： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">create</span><span class="params">(@RequestBody UserEntityForm form)</span> </span>&#123;&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a>@PathVariable</h3><p>此注解放入接口方法的参数前面，要求里面的值出现在Mapping中，以{}包裹，如下</p>
<p>接受参数required，设置判断此字段是否必须</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> UserView <span class="title">userInfoById</span><span class="params">(@PathVariable(<span class="string">"id"</span>,required = <span class="keyword">true</span>)</span> Integer id) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="RequestParam"><a href="#RequestParam" class="headerlink" title="@RequestParam"></a>@RequestParam</h3><p>此注解放入接口方法的参数前面，前端放入请求参数中，非body里面</p>
<p>接受参数required，设置判断此字段是否必须</p>
<p>defaultValue 设置此字段的默认值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> UserView <span class="title">userInfoById</span><span class="params">(@RequestParam(value = <span class="string">"id"</span>, required = <span class="keyword">false</span>, defaultValue = <span class="string">"1"</span>)</span> Integer id）</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>所有的接口方法都应该设计为幂等性，即接口请求多次或一次都应该达到同样的效果。此特性在高并发下面非常适用。</strong></p>
<h2 id="高并发的核心技术-幂等的实现方案"><a href="#高并发的核心技术-幂等的实现方案" class="headerlink" title="高并发的核心技术 - 幂等的实现方案"></a>高并发的核心技术 - 幂等的实现方案</h2><h3 id="一、背景"><a href="#一、背景" class="headerlink" title="一、背景"></a>一、背景</h3><p>我们实际系统中有很多操作，是不管做多少次，都应该产生一样的效果或返回一样的结果。  例如： </p>
<ol>
<li>前端重复提交选中的数据，应该后台只产生对应这个数据的一个反应结果。  2. 我们发起一笔付款请求，应该只扣用户账户一次钱，当遇到网络重发或系统bug重发，也应该只扣一次钱；  3. 发送消息，也应该只发一次，同样的短信发给用户，用户会哭的；  4. 创建业务订单，一次业务请求只能创建一个，创建多个就会出大问题。 </li>
</ol>
<p>等等很多重要的情况，这些逻辑都需要幂等的特性来支持。 </p>
<h3 id="二、幂等性概念"><a href="#二、幂等性概念" class="headerlink" title="二、幂等性概念"></a>二、幂等性概念</h3><p>幂等（idempotent、idempotence）是一个数学与计算机学概念，常见于抽象代数中。 </p>
<p>在编程中.一个幂等操作的特点是其任意多次执行所产生的影响均与一次执行的影响相同。幂等函数，或幂等方法，是指可以使用相同参数重复执行，并能获得相同结果的函数。这些函数不会影响系统状态，也不用担心重复执行会对系统造成改变。例如，“getUsername()和setTrue()”函数就是一个幂等函数. </p>
<p>更复杂的操作幂等保证是利用唯一交易号(流水号)实现. </p>
<p>我的理解：幂等就是一个操作，不论执行多少次，产生的效果和返回的结果都是一样的 </p>
<h3 id="三、技术方案"><a href="#三、技术方案" class="headerlink" title="三、技术方案"></a>三、技术方案</h3><ol>
<li><p>查询操作  查询一次和查询多次，在数据不变的情况下，查询结果是一样的。select是天然的幂等操作 </p>
</li>
<li><p>删除操作  删除操作也是幂等的，删除一次和多次删除都是把数据删除。(注意可能返回结果不一样，删除的数据不存在，返回0，删除的数据多条，返回结果多个) </p>
</li>
</ol>
<p>3.唯一索引，防止新增脏数据  比如：支付宝的资金账户，支付宝也有用户账户，每个用户只能有一个资金账户，怎么防止给用户创建资金账户多个，那么给资金账户表中的用户ID加唯一索引，所以一个用户新增成功一个资金账户记录 </p>
<p>要点：  唯一索引或唯一组合索引来防止新增数据存在脏数据  （当表存在唯一索引，并发时新增报错时，再查询一次就可以了，数据应该已经存在了，返回结果即可） </p>
<ol start="4">
<li>token机制，防止页面重复提交  业务要求：  页面的数据只能被点击提交一次  发生原因：  由于重复点击或者网络重发，或者nginx重发等情况会导致数据被重复提交  解决办法：  集群环境：采用token加redis（redis单线程的，处理需要排队）  单JVM环境：采用token加redis或token加jvm内存  处理流程：  1. 数据提交前要向服务的申请token，token放到redis或jvm内存，token有效时间  2. 提交后后台校验token，同时删除token，生成新的token返回  token特点：  要申请，一次有效性，可以限流 </li>
</ol>
<p>注意：redis要用删除操作来判断token，删除成功代表token校验通过，如果用select+delete来校验token，存在并发问题，不建议使用 </p>
<ol start="5">
<li><p>悲观锁  获取数据的时候加锁获取  select * from table_xxx where id=’xxx’ for update;  注意：id字段一定是主键或者唯一索引，不然是锁表，会死人的  悲观锁使用时一般伴随事务一起使用，数据锁定时间可能会很长，根据实际情况选用 </p>
</li>
<li><p>乐观锁  乐观锁只是在更新数据那一刻锁表，其他时间不锁表，所以相对于悲观锁，效率更高。 </p>
</li>
</ol>
<p>乐观锁的实现方式多种多样可以通过version或者其他状态条件：  1. 通过版本号实现  update table_xxx set name=#name#,version=version+1 where version=#version#  如下图(来自网上)： </p>
<p><img src="https://cdn.jsdelivr.net/gh/removeif/blog_image/20190620160456.png" alt=""></p>
<ol start="2">
<li>通过条件限制  update tablexxx set avaiamount=avaiamount-#subAmount# where avaiamount-#subAmount# &gt;= 0  要求：quality-#subQuality# &gt;= ，这个情景适合不用版本号，只更新是做数据安全校验，适合库存模型，扣份额和回滚份额，性能更高 </li>
</ol>
<p>注意：乐观锁的更新操作，最好用主键或者唯一索引来更新,这样是行锁，否则更新时会锁表，上面两个sql改成下面的两个更好  update tablexxx set name=#name#,version=version+1 where id=#id# and version=#version#  update tablexxx set avaiamount=avaiamount-#subAmount# where id=#id# and avai_amount-#subAmount# &gt;= 0 </p>
<ol start="7">
<li>分布式锁  还是拿插入数据的例子，如果是分布是系统，构建全局唯一索引比较困难，例如唯一性的字段没法确定，这时候可以引入分布式锁，通过第三方的系统(redis或zookeeper)，在业务系统插入数据或者更新数据，获取分布式锁，然后做操作，之后释放锁，这样其实是把多线程并发的锁的思路，引入多多个系统，也就是分布式系统中得解决思路。 </li>
</ol>
<p>要点：某个长流程处理过程要求不能并发执行，可以在流程执行之前根据某个标志(用户ID+后缀等)获取分布式锁，其他流程执行时获取锁就会失败，也就是同一时间该流程只能有一个能执行成功，执行完成后，释放分布式锁(分布式锁要第三方系统提供) </p>
<ol start="8">
<li><p>select + insert  并发不高的后台系统，或者一些任务JOB，为了支持幂等，支持重复执行，简单的处理方法是，先查询下一些关键数据，判断是否已经执行过，在进行业务处理，就可以了  注意：核心高并发流程不要用这种方法 </p>
</li>
<li><p>状态机幂等  在设计单据相关的业务，或者是任务相关的业务，肯定会涉及到状态机(状态变更图)，就是业务单据上面有个状态，状态在不同的情况下会发生变更，一般情况下存在有限状态机，这时候，如果状态机已经处于下一个状态，这时候来了一个上一个状态的变更，理论上是不能够变更的，这样的话，保证了有限状态机的幂等。 </p>
</li>
</ol>
<p>注意：订单等单据类业务，存在很长的状态流转，一定要深刻理解状态机，对业务系统设计能力提高有很大帮助 </p>
<ol start="10">
<li>对外提供接口的api如何保证幂等  如银联提供的付款接口：需要接入商户提交付款请求时附带：source来源，seq序列号  source+seq在数据库里面做唯一索引，防止多次付款，(并发时，只能处理一个请求) </li>
</ol>
<p><strong>重点</strong>对外提供接口为了支持幂等调用，接口有两个字段必须传，一个是来源source，一个是来源方序列号seq，这个两个字段在提供方系统里面做联合唯一索引，这样当第三方调用时，先在本方系统里面查询一下，是否已经处理过，返回相应处理结果；没有处理过，进行相应处理，返回结果。注意，为了幂等友好，一定要先查询一下，是否处理过该笔业务，不查询直接插入业务系统，会报错，但实际已经处理了。 </p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>幂等性应该是合格程序员的一个基因，在设计系统时，是首要考虑的问题，尤其是在像支付宝，银行，互联网金融公司等涉及的都是钱的系统，既要高效，数据也要准确，所以不能出现多扣款，多打款等问题，这样会很难处理，用户体验也不好</p>
<p><a href="https://mp.weixin.qq.com/s/xy4Jg3LrK0dpYy5q4rAAaw" target="_blank" rel="noopener">参考自</a></p>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    辣椒の酱
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://removeif.github.io/design-architecture/restful-api-设计以及幂等性相关设计.html" title="restful api 设计以及幂等性相关设计">https://removeif.github.io/design-architecture/restful-api-设计以及幂等性相关设计.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
  </li>
  <li class="post-copyright-license">
      <strong>文章评论：</strong>
      <a href="https://removeif.github.io/design-architecture/restful-api-设计以及幂等性相关设计.html#comment-container">点击评论</a>
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/remove.io/tags/幂等性-restful-api/" rel="tag"># 幂等性,restful-api</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/remove.io/database/mysql/一千行-MySQL-学习笔记-转载.html" rel="next" title="一千行 MySQL 学习笔记(转载)">
                <i class="fa fa-chevron-left"></i> 一千行 MySQL 学习笔记(转载)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/remove.io/java/elasticsearch/Elasticsearch常用工具api.html" rel="prev" title="Elasticsearch常用工具api">
                Elasticsearch常用工具api <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://cdn.jsdelivr.net/gh/removeif/removeif.github.io@master/images/tuzi.jpg" alt="辣椒の酱">
            
              <p class="site-author-name" itemprop="name">辣椒の酱</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/remove.io/archives/">
              
                  <span class="site-state-item-count">81</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/remove.io/categories/index.html">
                  <span class="site-state-item-count">35</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/remove.io/tags/index.html">
                  <span class="site-state-item-count">61</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/remove.io/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS

                <!-- <div>
                此处是广告
                </div>
                -->
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#针对以上restful-api-代码需要注意一下几点："><span class="nav-number">1.</span> <span class="nav-text">针对以上restful-api 代码需要注意一下几点：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RestController-注解"><span class="nav-number">1.1.</span> <span class="nav-text">@RestController 注解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RequestMapping"><span class="nav-number">1.2.</span> <span class="nav-text">@RequestMapping</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GetMapping"><span class="nav-number">1.3.</span> <span class="nav-text">@GetMapping</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PostMapping"><span class="nav-number">1.4.</span> <span class="nav-text">@PostMapping</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#putMapping"><span class="nav-number">1.5.</span> <span class="nav-text">@putMapping</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#deleteMapping"><span class="nav-number">1.6.</span> <span class="nav-text">@deleteMapping</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RequestBody"><span class="nav-number">1.7.</span> <span class="nav-text">@RequestBody</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PathVariable"><span class="nav-number">1.8.</span> <span class="nav-text">@PathVariable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RequestParam"><span class="nav-number">1.9.</span> <span class="nav-text">@RequestParam</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#高并发的核心技术-幂等的实现方案"><span class="nav-number">2.</span> <span class="nav-text">高并发的核心技术 - 幂等的实现方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一、背景"><span class="nav-number">2.1.</span> <span class="nav-text">一、背景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、幂等性概念"><span class="nav-number">2.2.</span> <span class="nav-text">二、幂等性概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、技术方案"><span class="nav-number">2.3.</span> <span class="nav-text">三、技术方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">2.4.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">辣椒の酱</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/remove.io/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/remove.io/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/remove.io/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/remove.io/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/remove.io/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/remove.io/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/remove.io/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/remove.io/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/remove.io/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/remove.io/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/remove.io/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/remove.io/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/remove.io/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
